<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaruFit - 비즈니스 로직 정의서</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            padding: 2rem 0;
        }
        .logic-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #6366f1;
            border-bottom: 3px solid #6366f1;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        h2 {
            color: #4f46e5;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-left: 1rem;
            border-left: 4px solid #6366f1;
        }
        h3 {
            color: #6366f1;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        h4 {
            color: #8b5cf6;
            margin-top: 1rem;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9ff;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .logic-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .logic-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.1);
        }
        .flow-step {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .flow-step::before {
            content: "→ ";
            color: #0ea5e9;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        .validation-rule {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .validation-rule::before {
            content: "✓ ";
            color: #f59e0b;
            font-weight: bold;
        }
        .exception-rule {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        .exception-rule::before {
            content: "⚠ ";
            color: #ef4444;
            font-weight: bold;
        }
        .data-table {
            width: 100%;
            margin-top: 1rem;
            border-collapse: collapse;
        }
        .data-table th {
            background: #6366f1;
            color: white;
            padding: 0.75rem;
            text-align: left;
        }
        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .data-table tr:hover {
            background: #f8f9ff;
        }
        .badge-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .badge-high {
            background: #ef4444;
            color: white;
        }
        .badge-medium {
            background: #f59e0b;
            color: white;
        }
        .badge-low {
            background: #10b981;
            color: white;
        }
        .pseudo-code {
            background: #1f2937;
            color: #10b981;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .pseudo-code::before {
            content: "코드 예시:";
            display: block;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="logic-container">
        <h1>HaruFit - 비즈니스 로직 정의서</h1>
        
        <div class="section">
            <h2>1. 사용자 관리 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>1.1 회원가입</h3>
                <h4>기능 개요</h4>
                <p>신규 사용자가 이메일, 비밀번호, 닉네임을 입력하여 계정을 생성합니다.</p>
                
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>email</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>사용자 이메일 주소</td>
                        </tr>
                        <tr>
                            <td>password</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>비밀번호 (최소 8자, 영문+숫자 조합)</td>
                        </tr>
                        <tr>
                            <td>nickname</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>사용자 닉네임 (2-20자)</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">이메일 형식 검증 (정규식: /^[^\s@]+@[^\s@]+\.[^\s@]+$/)</div>
                <div class="flow-step">비밀번호 강도 검증 (최소 8자, 영문+숫자 포함)</div>
                <div class="flow-step">닉네임 길이 검증 (2-20자)</div>
                <div class="flow-step">이메일 중복 확인 (users 테이블에서 email 조회)</div>
                <div class="flow-step">닉네임 중복 확인 (users 테이블에서 nickname 조회)</div>
                <div class="flow-step">비밀번호 해시화 (password_hash 함수 사용, PASSWORD_DEFAULT 알고리즘)</div>
                <div class="flow-step">users 테이블에 신규 레코드 INSERT</div>
                <div class="flow-step">회원가입 성공 메시지 반환</div>
                
                <h4>검증 규칙</h4>
                <div class="validation-rule">이메일은 유효한 형식이어야 함</div>
                <div class="validation-rule">비밀번호는 최소 8자 이상, 영문과 숫자 포함</div>
                <div class="validation-rule">닉네임은 2-20자 사이</div>
                <div class="validation-rule">이메일은 중복될 수 없음</div>
                <div class="validation-rule">닉네임은 중복될 수 없음</div>
                
                <h4>예외 처리</h4>
                <div class="exception-rule">이메일 중복 시: "이미 사용 중인 이메일입니다." 오류 반환</div>
                <div class="exception-rule">닉네임 중복 시: "이미 사용 중인 닉네임입니다." 오류 반환</div>
                <div class="exception-rule">검증 실패 시: 해당 필드의 오류 메시지 반환</div>
                <div class="exception-rule">데이터베이스 오류 시: "회원가입 중 오류가 발생했습니다." 오류 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>1.2 로그인</h3>
                <h4>기능 개요</h4>
                <p>등록된 사용자가 이메일과 비밀번호로 시스템에 접근합니다.</p>
                
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>email</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>사용자 이메일 주소</td>
                        </tr>
                        <tr>
                            <td>password</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>비밀번호</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">이메일과 비밀번호 입력값 검증 (빈 값 체크)</div>
                <div class="flow-step">users 테이블에서 email로 사용자 조회</div>
                <div class="flow-step">사용자 존재 여부 확인</div>
                <div class="flow-step">비밀번호 검증 (password_verify 함수 사용)</div>
                <div class="flow-step">세션 생성 (user_id, email, nickname 저장)</div>
                <div class="flow-step">로그인 성공 및 메인 페이지로 리다이렉트</div>
                
                <h4>검증 규칙</h4>
                <div class="validation-rule">이메일과 비밀번호는 필수 입력</div>
                <div class="validation-rule">이메일로 등록된 사용자가 존재해야 함</div>
                <div class="validation-rule">입력한 비밀번호가 저장된 해시와 일치해야 함</div>
                
                <h4>예외 처리</h4>
                <div class="exception-rule">사용자 미존재 시: "이메일 또는 비밀번호가 올바르지 않습니다." 오류 반환</div>
                <div class="exception-rule">비밀번호 불일치 시: "이메일 또는 비밀번호가 올바르지 않습니다." 오류 반환</div>
                <div class="exception-rule">세션 생성 실패 시: "로그인 중 오류가 발생했습니다." 오류 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>1.3 로그아웃</h3>
                <h4>기능 개요</h4>
                <p>현재 로그인된 사용자의 세션을 종료합니다.</p>
                
                <h4>처리 과정</h4>
                <div class="flow-step">현재 세션 확인</div>
                <div class="flow-step">세션 데이터 삭제 (session_unset)</div>
                <div class="flow-step">세션 파괴 (session_destroy)</div>
                <div class="flow-step">로그인 페이지로 리다이렉트</div>
            </div>
            
            <div class="logic-card">
                <h3>1.4 프로필 관리</h3>
                <h4>기능 개요</h4>
                <p>사용자가 자신의 신체 정보를 입력하거나 수정합니다.</p>
                
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>height</td>
                            <td>Decimal(5,2)</td>
                            <td>✗</td>
                            <td>키 (cm, 100-250 범위)</td>
                        </tr>
                        <tr>
                            <td>weight</td>
                            <td>Decimal(5,2)</td>
                            <td>✗</td>
                            <td>몸무게 (kg, 30-300 범위)</td>
                        </tr>
                        <tr>
                            <td>age</td>
                            <td>Integer</td>
                            <td>✗</td>
                            <td>나이 (10-150 범위)</td>
                        </tr>
                        <tr>
                            <td>gender</td>
                            <td>Enum</td>
                            <td>✗</td>
                            <td>성별 (male, female, other)</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">입력값 범위 검증 (키: 100-250cm, 몸무게: 30-300kg, 나이: 10-150세)</div>
                <div class="flow-step">users 테이블에서 현재 사용자 조회</div>
                <div class="flow-step">프로필 정보 UPDATE (WHERE user_id = 현재 사용자 ID)</div>
                <div class="flow-step">업데이트 성공 메시지 반환</div>
                
                <h4>검증 규칙</h4>
                <div class="validation-rule">키는 100-250cm 범위</div>
                <div class="validation-rule">몸무게는 30-300kg 범위</div>
                <div class="validation-rule">나이는 10-150세 범위</div>
                <div class="validation-rule">성별은 male, female, other 중 하나</div>
            </div>
        </div>
        
        <div class="section">
            <h2>2. 운동 루틴 관리 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>2.1 루틴 생성</h3>
                <h4>기능 개요</h4>
                <p>사용자가 새로운 운동 루틴을 생성하고 운동 종목을 추가합니다.</p>
                
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>name</td>
                            <td>String</td>
                            <td>✓</td>
                            <td>루틴 이름 (1-100자)</td>
                        </tr>
                        <tr>
                            <td>description</td>
                            <td>Text</td>
                            <td>✗</td>
                            <td>루틴 설명</td>
                        </tr>
                        <tr>
                            <td>exercises</td>
                            <td>Array</td>
                            <td>✓</td>
                            <td>운동 종목 배열 (최소 1개)</td>
                        </tr>
                        <tr>
                            <td>exercises[].exercise_id</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>운동 종목 ID</td>
                        </tr>
                        <tr>
                            <td>exercises[].sets</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>세트 수 (1-20)</td>
                        </tr>
                        <tr>
                            <td>exercises[].reps</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>반복 횟수 (1-100)</td>
                        </tr>
                        <tr>
                            <td>exercises[].weight</td>
                            <td>Decimal</td>
                            <td>✗</td>
                            <td>무게 (kg, 0-500)</td>
                        </tr>
                        <tr>
                            <td>exercises[].rest_time</td>
                            <td>Integer</td>
                            <td>✗</td>
                            <td>휴식 시간 (초, 0-600)</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">루틴 이름 검증 (1-100자, 중복 확인)</div>
                <div class="flow-step">운동 종목 배열 검증 (최소 1개 이상)</div>
                <div class="flow-step">각 운동 종목 데이터 검증 (exercise_id 존재 확인, sets/reps 범위 확인)</div>
                <div class="flow-step">트랜잭션 시작</div>
                <div class="flow-step">routines 테이블에 루틴 INSERT</div>
                <div class="flow-step">routine_exercises 테이블에 각 운동 종목 INSERT (루프)</div>
                <div class="flow-step">트랜잭션 커밋</div>
                <div class="flow-step">생성된 루틴 ID 반환</div>
                
                <h4>검증 규칙</h4>
                <div class="validation-rule">루틴 이름은 1-100자 사이</div>
                <div class="validation-rule">운동 종목은 최소 1개 이상 필수</div>
                <div class="validation-rule">세트 수는 1-20 범위</div>
                <div class="validation-rule">반복 횟수는 1-100 범위</div>
                <div class="validation-rule">무게는 0-500kg 범위</div>
                <div class="validation-rule">휴식 시간은 0-600초 범위</div>
                <div class="validation-rule">exercise_id는 exercises 테이블에 존재해야 함</div>
            </div>
            
            <div class="logic-card">
                <h3>2.2 루틴 수정</h3>
                <h4>기능 개요</h4>
                <p>기존 루틴의 정보와 운동 종목을 수정합니다.</p>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">루틴 소유권 확인 (routines 테이블에서 user_id 일치 확인)</div>
                <div class="flow-step">입력 데이터 검증 (생성과 동일)</div>
                <div class="flow-step">트랜잭션 시작</div>
                <div class="flow-step">routines 테이블 UPDATE</div>
                <div class="flow-step">기존 routine_exercises 레코드 삭제</div>
                <div class="flow-step">새로운 routine_exercises 레코드 INSERT</div>
                <div class="flow-step">트랜잭션 커밋</div>
                <div class="flow-step">수정 완료 메시지 반환</div>
                
                <h4>검증 규칙</h4>
                <div class="validation-rule">루틴 소유자만 수정 가능</div>
                <div class="validation-rule">루틴 생성과 동일한 검증 규칙 적용</div>
            </div>
            
            <div class="logic-card">
                <h3>2.3 루틴 삭제</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">루틴 소유권 확인</div>
                <div class="flow-step">트랜잭션 시작</div>
                <div class="flow-step">routine_exercises 테이블에서 관련 레코드 삭제 (CASCADE 또는 수동)</div>
                <div class="flow-step">routines 테이블에서 루틴 삭제</div>
                <div class="flow-step">트랜잭션 커밋</div>
                <div class="flow-step">삭제 완료 메시지 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>2.4 루틴 목록 조회</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">routines 테이블에서 user_id로 조회</div>
                <div class="flow-step">각 루틴의 운동 종목 조회 (JOIN 또는 별도 쿼리)</div>
                <div class="flow-step">루틴 목록 반환 (JSON 형식)</div>
            </div>
            
            <div class="logic-card">
                <h3>2.5 루틴 실행</h3>
                <h4>기능 개요</h4>
                <p>사용자가 루틴을 선택하여 운동을 시작하고 세트별 기록을 입력합니다.</p>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">루틴 존재 및 소유권 확인</div>
                <div class="flow-step">루틴의 운동 종목 목록 조회</div>
                <div class="flow-step">운동 실행 화면 표시</div>
                <div class="flow-step">사용자가 세트별 기록 입력 (무게, 횟수, 시간)</div>
                <div class="flow-step">운동 완료 시 기록 저장 (workout_logs, workout_sets 테이블에 INSERT)</div>
                <div class="flow-step">운동 완료 메시지 반환</div>
            </div>
        </div>
        
        <div class="section">
            <h2>3. 운동 기록 관리 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>3.1 운동 기록 저장</h3>
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>routine_id</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>실행한 루틴 ID</td>
                        </tr>
                        <tr>
                            <td>workout_date</td>
                            <td>Date</td>
                            <td>✓</td>
                            <td>운동 날짜</td>
                        </tr>
                        <tr>
                            <td>duration</td>
                            <td>Integer</td>
                            <td>✗</td>
                            <td>운동 시간 (분)</td>
                        </tr>
                        <tr>
                            <td>notes</td>
                            <td>Text</td>
                            <td>✗</td>
                            <td>메모</td>
                        </tr>
                        <tr>
                            <td>sets</td>
                            <td>Array</td>
                            <td>✓</td>
                            <td>세트별 기록 배열</td>
                        </tr>
                        <tr>
                            <td>sets[].exercise_id</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>운동 종목 ID</td>
                        </tr>
                        <tr>
                            <td>sets[].set_number</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>세트 번호</td>
                        </tr>
                        <tr>
                            <td>sets[].weight</td>
                            <td>Decimal</td>
                            <td>✗</td>
                            <td>무게 (kg)</td>
                        </tr>
                        <tr>
                            <td>sets[].reps</td>
                            <td>Integer</td>
                            <td>✓</td>
                            <td>반복 횟수</td>
                        </tr>
                        <tr>
                            <td>sets[].rest_time</td>
                            <td>Integer</td>
                            <td>✗</td>
                            <td>휴식 시간 (초)</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">입력 데이터 검증</div>
                <div class="flow-step">트랜잭션 시작</div>
                <div class="flow-step">workout_logs 테이블에 운동 기록 INSERT</div>
                <div class="flow-step">workout_sets 테이블에 각 세트 기록 INSERT (루프)</div>
                <div class="flow-step">트랜잭션 커밋</div>
                <div class="flow-step">저장 완료 메시지 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>3.2 기록 조회</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">조회 조건 설정 (날짜 범위, 운동 종목, 루틴 등)</div>
                <div class="flow-step">workout_logs 테이블에서 조건에 맞는 기록 조회</div>
                <div class="flow-step">각 기록의 세트 정보 조회 (workout_sets JOIN)</div>
                <div class="flow-step">기록 목록 반환 (JSON 형식)</div>
            </div>
            
            <div class="logic-card">
                <h3>3.3 통계 및 차트</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">통계 기간 설정 (일간, 주간, 월간, 연간)</div>
                <div class="flow-step">운동 빈도 계산 (기간별 운동 횟수)</div>
                <div class="flow-step">무게 증가 추이 계산 (운동별 평균 무게 변화)</div>
                <div class="flow-step">총 운동 시간 계산</div>
                <div class="flow-step">운동 종목별 통계 계산</div>
                <div class="flow-step">차트 데이터 형식으로 변환 (Chart.js 호환 형식)</div>
                <div class="flow-step">통계 데이터 반환</div>
            </div>
        </div>
        
        <div class="section">
            <h2>4. 목표 관리 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>4.1 목표 설정</h3>
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>goal_type</td>
                            <td>Enum</td>
                            <td>✓</td>
                            <td>목표 유형 (weight, muscle, frequency, etc.)</td>
                        </tr>
                        <tr>
                            <td>target_value</td>
                            <td>Decimal</td>
                            <td>✓</td>
                            <td>목표 값</td>
                        </tr>
                        <tr>
                            <td>current_value</td>
                            <td>Decimal</td>
                            <td>✓</td>
                            <td>현재 값</td>
                        </tr>
                        <tr>
                            <td>deadline</td>
                            <td>Date</td>
                            <td>✓</td>
                            <td>목표 달성 기한</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">입력 데이터 검증 (목표 유형, 값 범위, 기한 날짜)</div>
                <div class="flow-step">목표 유형별 검증 (체중: 30-300kg, 운동 빈도: 1-7회/주 등)</div>
                <div class="flow-step">goals 테이블에 목표 INSERT</div>
                <div class="flow-step">목표 설정 완료 메시지 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>4.2 목표 진행률 조회</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">goals 테이블에서 사용자의 활성 목표 조회</div>
                <div class="flow-step">각 목표의 현재 값 조회 (목표 유형에 따라 다른 테이블 참조)</div>
                <div class="flow-step">진행률 계산: ((current_value - initial_value) / (target_value - initial_value)) * 100</div>
                <div class="flow-step">목표 상태 업데이트 (진행률 100% 이상 시 status = 'completed')</div>
                <div class="flow-step">진행률 데이터 반환</div>
            </div>
        </div>
        
        <div class="section">
            <h2>5. 운동 일지 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>5.1 일지 작성</h3>
                <h4>입력 데이터</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>필드명</th>
                            <th>타입</th>
                            <th>필수</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>workout_date</td>
                            <td>Date</td>
                            <td>✓</td>
                            <td>일지 작성 날짜</td>
                        </tr>
                        <tr>
                            <td>content</td>
                            <td>Text</td>
                            <td>✓</td>
                            <td>일지 내용 (최소 10자)</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">일지 내용 검증 (최소 10자)</div>
                <div class="flow-step">해당 날짜의 일지 중복 확인 (선택사항: 하루에 하나만 작성 가능)</div>
                <div class="flow-step">workout_journals 테이블에 일지 INSERT</div>
                <div class="flow-step">일지 작성 완료 메시지 반환</div>
            </div>
            
            <div class="logic-card">
                <h3>5.2 일지 조회</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">조회 조건 설정 (날짜 범위, 정렬 순서)</div>
                <div class="flow-step">workout_journals 테이블에서 사용자의 일지 조회</div>
                <div class="flow-step">일지 목록 반환 (날짜순 정렬)</div>
            </div>
            
            <div class="logic-card">
                <h3>5.3 일지 수정/삭제</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">로그인 세션 확인</div>
                <div class="flow-step">일지 소유권 확인</div>
                <div class="flow-step">수정: workout_journals 테이블 UPDATE</div>
                <div class="flow-step">삭제: workout_journals 테이블 DELETE</div>
                <div class="flow-step">작업 완료 메시지 반환</div>
            </div>
        </div>
        
        <div class="section">
            <h2>6. 공통 비즈니스 로직</h2>
            
            <div class="logic-card">
                <h3>6.1 인증 및 권한 확인</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">모든 보호된 페이지/API에서 세션 확인</div>
                <div class="flow-step">세션에 user_id가 없으면 로그인 페이지로 리다이렉트</div>
                <div class="flow-step">리소스 소유권 확인 (본인의 데이터만 접근 가능)</div>
            </div>
            
            <div class="logic-card">
                <h3>6.2 데이터 검증</h3>
                <h4>공통 검증 규칙</h4>
                <div class="validation-rule">SQL Injection 방지: PDO Prepared Statement 사용</div>
                <div class="validation-rule">XSS 방지: htmlspecialchars 함수로 출력 데이터 이스케이프</div>
                <div class="validation-rule">입력값 길이 제한: 데이터베이스 스키마에 맞는 길이 검증</div>
                <div class="validation-rule">숫자 범위 검증: 최소값/최대값 체크</div>
                <div class="validation-rule">날짜 형식 검증: YYYY-MM-DD 형식</div>
            </div>
            
            <div class="logic-card">
                <h3>6.3 오류 처리</h3>
                <h4>처리 과정</h4>
                <div class="flow-step">모든 예외 상황에 대한 명확한 오류 메시지 제공</div>
                <div class="flow-step">데이터베이스 오류는 사용자에게 친화적인 메시지로 변환</div>
                <div class="flow-step">오류 로그 기록 (error_log 함수 사용)</div>
                <div class="flow-step">JSON API 응답 형식: {"result": true/false, "data": {}, "error": ""}</div>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <p class="text-muted">문서 작성일: 2026년 1월</p>
            <p class="text-muted">버전: 1.0</p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

